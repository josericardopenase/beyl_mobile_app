"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=JoinTrainer;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _formik=require("formik");var _eventingBus=_interopRequireDefault(require("eventing-bus"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _form=_interopRequireDefault(require("../../../general_components/form"));var _FormButton=_interopRequireDefault(require("../../../general_components/forms/FormButton"));var _formCompleteInput=_interopRequireDefault(require("../../../general_components/forms/input_types/formCompleteInput"));var _generalContainer=_interopRequireDefault(require("../../../general_components/generalContainer"));var _bold=_interopRequireDefault(require("../../../general_components/titles/bold"));var _title=_interopRequireDefault(require("../../../general_components/titles/title1"));var Yup=_interopRequireWildcard(require("yup"));var _apiInvitationKey=_interopRequireDefault(require("../../../../api/apiInvitationKey"));var _titleError=_interopRequireDefault(require("../../../general_components/titles/titleError"));var _palleteColors=_interopRequireDefault(require("../../../general_components/palleteColors"));var _title2=_interopRequireDefault(require("../../../general_components/titles/title3"));var _title3=_interopRequireDefault(require("../../../general_components/titles/title5"));var _apiSettings=_interopRequireDefault(require("../../../../api/apiSettings"));var _native=require("@react-navigation/native");var _useApiCallback=_interopRequireDefault(require("../../../../customHooks/useApiCallback"));var _events=require("../../../../events/events");var _loading=_interopRequireDefault(require("../../../general_components/loading"));var _Ionicons=_interopRequireDefault(require("@expo/vector-icons/Ionicons"));var _jsxFileName="/home/pepe/Escritorio/beyl/beyl_mobile_app/components/normal_navigation/components/profile/joinTrainer.js";var validationSchema=Yup.object().shape({key:Yup.string().required("El código es necesario").min(8,"El código debe ser de 8 caracteres").max(8,"El código debe ser de 8 caracteres")});function JoinTrainer(){var _React$createElement;var _useState=(0,_react.useState)(""),_useState2=(0,_slicedToArray2["default"])(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=(0,_react.useState)(false),_useState4=(0,_slicedToArray2["default"])(_useState3,2),failed=_useState4[0],setFailed=_useState4[1];var _useState5=(0,_react.useState)(false),_useState6=(0,_slicedToArray2["default"])(_useState5,2),modal=_useState6[0],setModal=_useState6[1];var _useState7=(0,_react.useState)(),_useState8=(0,_slicedToArray2["default"])(_useState7,2),information=_useState8[0],setInformation=_useState8[1];var _useState9=(0,_react.useState)(),_useState10=(0,_slicedToArray2["default"])(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var _useState11=(0,_react.useState)(),_useState12=(0,_slicedToArray2["default"])(_useState11,2),success=_useState12[0],setSuccess=_useState12[1];var navigation=(0,_native.useNavigation)();var handleSubmit=function handleSubmit(_ref){var key,result;return _regenerator["default"].async(function handleSubmit$(_context){while(1){switch(_context.prev=_context.next){case 0:key=_ref.key;_context.next=3;return _regenerator["default"].awrap(_apiInvitationKey["default"].validate(key));case 3:result=_context.sent;if(result.ok){_context.next=8;break;}setFailed(true);setError(result.data.detail);return _context.abrupt("return");case 8:console.log(result.data);setInformation(result.data);setError(false);setModal(true);case 12:case"end":return _context.stop();}}});};var joinTrainer=function joinTrainer(){var result;return _regenerator["default"].async(function joinTrainer$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);_context2.next=3;return _regenerator["default"].awrap(_apiInvitationKey["default"].joinTrainer(information.key));case 3:result=_context2.sent;setLoading(false);if(result.ok){_context2.next=9;break;}setFailed(true);setError(result.data.detail);return _context2.abrupt("return");case 9:_eventingBus["default"].publish(_events.ADDED_TRAINER,information.trainer);setSuccess(true);case 11:case"end":return _context2.stop();}}});};return _react["default"].createElement(_reactNative.View,{style:{padding:10,flex:1},__source:{fileName:_jsxFileName,lineNumber:76,columnNumber:9}},_react["default"].createElement(_title["default"],{style:{marginTop:30},__source:{fileName:_jsxFileName,lineNumber:77,columnNumber:21}},_react["default"].createElement(_bold["default"],{__source:{fileName:_jsxFileName,lineNumber:77,columnNumber:53}},"Introduce")," tu c\xF3digo de entrenador"),_react["default"].createElement(_reactNative.View,{style:{marginTop:20},__source:{fileName:_jsxFileName,lineNumber:78,columnNumber:21}},_react["default"].createElement(_formik.Formik,{initialValues:{key:''},onSubmit:function onSubmit(values){return handleSubmit(values);},validationSchema:validationSchema,__source:{fileName:_jsxFileName,lineNumber:79,columnNumber:21}},function(_ref2){var handleSubmit=_ref2.handleSubmit;return _react["default"].createElement(_form["default"],{style:{marginTop:0},__source:{fileName:_jsxFileName,lineNumber:84,columnNumber:33}},_react["default"].createElement(_formCompleteInput["default"],{name:"key",placeholder:"C\xF3digo de entrenador",icon:"qrcode",__source:{fileName:_jsxFileName,lineNumber:85,columnNumber:37}}),_react["default"].createElement(_FormButton["default"],{placeholder:"Validar c\xF3digo",onPress:handleSubmit,__source:{fileName:_jsxFileName,lineNumber:86,columnNumber:37}}),_react["default"].createElement(_titleError["default"],{error:error,visible:failed,__source:{fileName:_jsxFileName,lineNumber:87,columnNumber:37}}));}),_react["default"].createElement(_reactNative.Modal,{animationType:"slide",transparent:true,visible:modal,onRequestClose:function onRequestClose(){Alert.alert('Modal has been closed.');},__source:{fileName:_jsxFileName,lineNumber:93,columnNumber:21}},_react["default"].createElement(_reactNative.View,{style:styles.centeredView,__source:{fileName:_jsxFileName,lineNumber:101,columnNumber:25}},information?_react["default"].createElement(_reactNative.View,{style:styles.modalView,__source:{fileName:_jsxFileName,lineNumber:104,columnNumber:33}},loading?_react["default"].createElement(_loading["default"],{__source:{fileName:_jsxFileName,lineNumber:109,columnNumber:45}}):!success?_react["default"].createElement(_react["default"].Fragment,null,_react["default"].createElement(_reactNative.View,{style:{alignItems:"center"},__source:{fileName:_jsxFileName,lineNumber:115,columnNumber:45}},_react["default"].createElement(_title3["default"],{__source:{fileName:_jsxFileName,lineNumber:116,columnNumber:49}},"code : ",information.key),_react["default"].createElement(_title["default"],{primary:true,__source:{fileName:_jsxFileName,lineNumber:117,columnNumber:49}},_react["default"].createElement(_bold["default"],{__source:{fileName:_jsxFileName,lineNumber:117,columnNumber:72}},information.trainer.user.first_name+" "+information.trainer.user.last_name)),_react["default"].createElement(_reactNative.Image,{style:{width:300,height:200,borderRadius:10,marginTop:10,marginBottom:10},source:{uri:information.trainer.user.profile_pic},__source:{fileName:_jsxFileName,lineNumber:118,columnNumber:49}})),_react["default"].createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){return joinTrainer();},__source:{fileName:_jsxFileName,lineNumber:121,columnNumber:45}},_react["default"].createElement(_FormButton["default"],{placeholder:"Es mi entrenador",__source:{fileName:_jsxFileName,lineNumber:122,columnNumber:49}})),_react["default"].createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){return setModal(false);},__source:{fileName:_jsxFileName,lineNumber:125,columnNumber:45}},_react["default"].createElement(_FormButton["default"],{placeholder:"Me he equivocado",background:_palleteColors["default"].background,color:_palleteColors["default"].mainColor,__source:{fileName:_jsxFileName,lineNumber:126,columnNumber:49}}))):_react["default"].createElement(_react["default"].Fragment,null,_react["default"].createElement(_reactNative.View,{style:{alignItems:"center"},__source:{fileName:_jsxFileName,lineNumber:132,columnNumber:45}},_react["default"].createElement(_title2["default"],(_React$createElement={primary:true},(0,_defineProperty2["default"])(_React$createElement,"primary",false),(0,_defineProperty2["default"])(_React$createElement,"__source",{fileName:_jsxFileName,lineNumber:133,columnNumber:49}),_React$createElement),"Felicidades"),_react["default"].createElement(_reactNative.Text,{style:{color:_palleteColors["default"].textPrimaryColor,fontSize:22,textAlign:"center"},__source:{fileName:_jsxFileName,lineNumber:134,columnNumber:49}},_react["default"].createElement(_bold["default"],{__source:{fileName:_jsxFileName,lineNumber:134,columnNumber:138}},"Te has unido correctamente"))),_react["default"].createElement(_Ionicons["default"],{name:"ios-checkmark-circle-outline",color:"#49AF40",size:148,style:{alignSelf:"center"},__source:{fileName:_jsxFileName,lineNumber:137,columnNumber:45}}),_react["default"].createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){return navigation.navigate("Profile");},style:{marginTop:10},__source:{fileName:_jsxFileName,lineNumber:138,columnNumber:45}},_react["default"].createElement(_FormButton["default"],{placeholder:"Genial",background:"#49AF40",__source:{fileName:_jsxFileName,lineNumber:139,columnNumber:49}})))):null))));}var styles=_reactNative.StyleSheet.create({centeredView:{flex:1,justifyContent:'center',alignItems:'center',backgroundColor:"rgba(0,0,0,0.7)"},modalView:{margin:20,backgroundColor:_palleteColors["default"].backgroundSecondary,borderRadius:20,padding:35,shadowColor:'#000',shadowOffset:{width:0,height:2},shadowOpacity:0.25,shadowRadius:3.84,elevation:5,width:"95%"},openButton:{backgroundColor:'#F194FF',borderRadius:20,padding:10,elevation:2},textStyle:{color:'white',fontWeight:'bold',textAlign:'center'},modalText:{marginBottom:15,textAlign:'center'}});