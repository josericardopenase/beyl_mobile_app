"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=SettingsAccount;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _icons=require("@material-ui/icons");var _formik=require("formik");var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactNativeGestureHandler=require("react-native-gesture-handler");var _form=_interopRequireDefault(require("../../../../general_components/form"));var _FormButton=_interopRequireDefault(require("../../../../general_components/forms/FormButton"));var _FormEmail=_interopRequireDefault(require("../../../../general_components/forms/high_level_inputs/FormEmail"));var _FormPassword=_interopRequireDefault(require("../../../../general_components/forms/high_level_inputs/FormPassword"));var _formCompleteInput=_interopRequireDefault(require("../../../../general_components/forms/input_types/formCompleteInput"));var _generalContainer=_interopRequireDefault(require("../../../../general_components/generalContainer"));var _bold=_interopRequireDefault(require("../../../../general_components/titles/bold"));var _title=_interopRequireDefault(require("../../../../general_components/titles/title1"));var _title2=_interopRequireDefault(require("../../../../general_components/titles/title3"));var _titleError=_interopRequireDefault(require("../../../../general_components/titles/titleError"));var ImagePicker=_interopRequireWildcard(require("expo-image-picker"));var Permissions=_interopRequireWildcard(require("expo-permissions"));var _useApiCallback=_interopRequireDefault(require("../../../../../customHooks/useApiCallback"));var _loading=_interopRequireDefault(require("../../../../general_components/loading"));var _apiProfile=_interopRequireDefault(require("../../../../../api/apiProfile"));var _profileImage=_interopRequireDefault(require("../../../../general_components/profileImage"));var _title3=_interopRequireDefault(require("../../../../general_components/titles/title5"));var _palleteColors=_interopRequireDefault(require("../../../../general_components/palleteColors"));var Yup=_interopRequireWildcard(require("yup"));var _native=require("@react-navigation/native");var _eventingBus=_interopRequireDefault(require("eventing-bus"));var _events=require("../../../../../events/events");var _jsxFileName="/home/pepe/Escritorio/beyl/beyl_mobile_app/components/normal_navigation/components/profile/settings/settingsAccount.js";var validationSchema=Yup.object().shape({email:Yup.string().required().email().label("Email"),name:Yup.string().required().label("Nombre"),surname:Yup.string().required().label("Apellidos")});function SettingsAccount(){var _useState=(0,_react.useState)(),_useState2=(0,_slicedToArray2["default"])(_useState,2),profile=_useState2[0],setProfile=_useState2[1];var _useState3=(0,_react.useState)(null),_useState4=(0,_slicedToArray2["default"])(_useState3,2),image=_useState4[0],setImage=_useState4[1];var navigation=(0,_native.useNavigation)();var getProfile=(0,_useApiCallback["default"])(_apiProfile["default"].getProfile,function(data){return setProfile(data);});var modifyProfile=(0,_useApiCallback["default"])(_apiProfile["default"].modifyProfile,function(data){_eventingBus["default"].publish(_events.MODIFIED_PROFILE);navigation.navigate("Settings");});var _useState5=(0,_react.useState)(false),_useState6=(0,_slicedToArray2["default"])(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var requestPermission=function requestPermission(){var result;return _regenerator["default"].async(function requestPermission$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regenerator["default"].awrap(Permissions.askAsync(Permissions.CAMERA,Permissions.CAMERA_ROLL));case 2:result=_context.sent;if(!granted)alert('Necesitas activar la camara para cambiar la imagen de perfil.');case 4:case"end":return _context.stop();}}});};var selectImage=function selectImage(setFieldValue){var result;return _regenerator["default"].async(function selectImage$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _regenerator["default"].awrap(ImagePicker.launchImageLibraryAsync({base64:true,quality:0.8,aspect:[1,1],allowsEditing:true}));case 3:result=_context2.sent;if(!result.cancelled){setImage(result.uri);setFieldValue("profile_pic",result.base64);}_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2["catch"](0);alert(_context2.t0);case 10:case"end":return _context2.stop();}}},null,null,[[0,7]]);};var handleSubmit=function handleSubmit(values){setLoading(true);modifyProfile.request(values);};(0,_react.useEffect)(function(){getProfile.request();requestPermission();},[]);if(getProfile.loading){return _react["default"].createElement(_loading["default"],{__source:{fileName:_jsxFileName,lineNumber:91,columnNumber:16}});}return _react["default"].createElement(_generalContainer["default"],{__source:{fileName:_jsxFileName,lineNumber:95,columnNumber:9}},_react["default"].createElement(_reactNativeGestureHandler.ScrollView,{showsVerticalScrollIndicator:false,__source:{fileName:_jsxFileName,lineNumber:96,columnNumber:13}},_react["default"].createElement(_reactNative.View,{style:{marginTop:20},__source:{fileName:_jsxFileName,lineNumber:98,columnNumber:13}},_react["default"].createElement(_formik.Formik,{initialValues:{email:profile.email,first_name:profile.first_name,last_name:profile.last_name},onSubmit:function onSubmit(values){return handleSubmit(values);},__source:{fileName:_jsxFileName,lineNumber:99,columnNumber:21}},function(_ref){var handleSubmit=_ref.handleSubmit,errors=_ref.errors,setFieldValue=_ref.setFieldValue;return _react["default"].createElement(_form["default"],{__source:{fileName:_jsxFileName,lineNumber:105,columnNumber:25}},_react["default"].createElement(_reactNativeGestureHandler.TouchableOpacity,{style:{alignItems:"center"},onPress:function onPress(){return selectImage(setFieldValue);},__source:{fileName:_jsxFileName,lineNumber:107,columnNumber:29}},_react["default"].createElement(_profileImage["default"],{size:100,url:image?image:profile.profile_pic,__source:{fileName:_jsxFileName,lineNumber:108,columnNumber:33}}),_react["default"].createElement(_title3["default"],{style:{marginTop:20,marginBottom:20},color:_palleteColors["default"].mainColor,__source:{fileName:_jsxFileName,lineNumber:109,columnNumber:33}},"Cambiar foto de perfil")),_react["default"].createElement(_FormEmail["default"],{defaultValue:profile.email,__source:{fileName:_jsxFileName,lineNumber:112,columnNumber:29}}),_react["default"].createElement(_formCompleteInput["default"],{defaultValue:profile.first_name,name:"first_name",initialValue:getProfile.data.email,placeholder:"Nombre",icon:"account",__source:{fileName:_jsxFileName,lineNumber:113,columnNumber:29}}),_react["default"].createElement(_formCompleteInput["default"],{defaultValue:profile.last_name,name:"last_name",placeholder:"Apellidos",icon:"account",__source:{fileName:_jsxFileName,lineNumber:114,columnNumber:29}}),_react["default"].createElement(_FormButton["default"],{placeholder:"Guardar",loading:loading,onPress:function onPress(){if(!loading)handleSubmit();},__source:{fileName:_jsxFileName,lineNumber:116,columnNumber:29}}));}))));}