"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=Login;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _form=_interopRequireDefault(require("../../general_components/form"));var _generalContainer=_interopRequireDefault(require("../../general_components/generalContainer"));var _title=_interopRequireDefault(require("../../general_components/titles/title1"));var _bold=_interopRequireDefault(require("../../general_components/titles/bold"));var _title2=_interopRequireDefault(require("../../general_components/titles/title5"));var _FormButton=_interopRequireDefault(require("../../general_components/forms/FormButton"));var _palleteColors=_interopRequireDefault(require("../../general_components/palleteColors"));var _FormFacebook=_interopRequireDefault(require("../../general_components/forms/social_media/FormFacebook"));var _FormGoogle=_interopRequireDefault(require("../../general_components/forms/social_media/FormGoogle"));var Yup=_interopRequireWildcard(require("yup"));var _formik=require("formik");var _FormEmail=_interopRequireDefault(require("../../general_components/forms/high_level_inputs/FormEmail"));var _FormPassword=_interopRequireDefault(require("../../general_components/forms/high_level_inputs/FormPassword"));var _apiAuth=_interopRequireDefault(require("../../../api/apiAuth"));var _titleError=_interopRequireDefault(require("../../general_components/titles/titleError"));var _context2=_interopRequireDefault(require("../../../auth/context"));var _storage=_interopRequireDefault(require("../../../auth/storage"));var _jsxFileName="/home/pepe/Escritorio/beylapp/components/login_navigation/Components/login.js";var validationSchema=Yup.object().shape({email:Yup.string().required().email().label("Email"),password:Yup.string().required().label("Password")});function Login(){var authContext=(0,_react.useContext)(_context2["default"]);var _useState=(0,_react.useState)(false),_useState2=(0,_slicedToArray2["default"])(_useState,2),loginFailed=_useState2[0],setLoginFailed=_useState2[1];var _useState3=(0,_react.useState)(""),_useState4=(0,_slicedToArray2["default"])(_useState3,2),error=_useState4[0],setError=_useState4[1];var handleSubmit=function handleSubmit(_ref){var email,password,result;return _regenerator["default"].async(function handleSubmit$(_context){while(1){switch(_context.prev=_context.next){case 0:email=_ref.email,password=_ref.password;_context.next=3;return _regenerator["default"].awrap(_apiAuth["default"].login(email,password));case 3:result=_context.sent;if(result.ok){_context.next=7;break;}if(result.data.non_field_errors!=undefined)setError(result.data.non_field_errors[0]);else{console.log(result);setError(result.data[0]);}return _context.abrupt("return",setLoginFailed(true));case 7:setLoginFailed(false);authContext.setUser(result.data.token);console.log(result);_storage["default"].setUser(result.data.token);case 11:case"end":return _context.stop();}}});};return _react["default"].createElement(_generalContainer["default"],{__source:{fileName:_jsxFileName,lineNumber:53,columnNumber:9}},_react["default"].createElement(_reactNative.View,{style:{justifyContent:"center",alignContent:"center"},__source:{fileName:_jsxFileName,lineNumber:54,columnNumber:13}},_react["default"].createElement(_title["default"],{style:{marginTop:20,alignSelf:"center"},__source:{fileName:_jsxFileName,lineNumber:58,columnNumber:17}},_react["default"].createElement(_bold["default"],{__source:{fileName:_jsxFileName,lineNumber:58,columnNumber:70}},"Inicia sesi\xF3n en Beyl")),_react["default"].createElement(_formik.Formik,{initialValues:{email:'',password:''},onSubmit:function onSubmit(values){return handleSubmit(values);},validationSchema:validationSchema,__source:{fileName:_jsxFileName,lineNumber:60,columnNumber:17}},function(_ref2){var handleSubmit=_ref2.handleSubmit;return _react["default"].createElement(_form["default"],{style:{marginTop:70},__source:{fileName:_jsxFileName,lineNumber:68,columnNumber:29}},_react["default"].createElement(_FormEmail["default"],{__source:{fileName:_jsxFileName,lineNumber:69,columnNumber:33}}),_react["default"].createElement(_FormPassword["default"],{__source:{fileName:_jsxFileName,lineNumber:70,columnNumber:33}}),_react["default"].createElement(_titleError["default"],{error:error,visible:loginFailed,__source:{fileName:_jsxFileName,lineNumber:71,columnNumber:33}}),_react["default"].createElement(_FormButton["default"],{placeholder:"\xBFOlvidaste tu contrase\xF1a?",background:_palleteColors["default"].background,color:_palleteColors["default"].textSecondaryColor,__source:{fileName:_jsxFileName,lineNumber:72,columnNumber:33}}),_react["default"].createElement(_FormButton["default"],{placeholder:"Acceder",onPress:handleSubmit,__source:{fileName:_jsxFileName,lineNumber:73,columnNumber:33}}));})));}